CREATE TABLE `country` (
  `id`             INT           NOT NULL AUTO_INCREMENT,
  `name`           TEXT          NOT NULL,
  `currency_code`  CHAR(3)       NOT NULL,
  `created_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `location` (
  `id`             INT           NOT NULL AUTO_INCREMENT,
  `latitude`       DECIMAL(9,6),
  `longitude`      DECIMAL(9,6),
  `address`        TEXT          NOT NULL,
  `country_id`     INT           NULL,
  `created_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`country_id`),
  CONSTRAINT `fk_location_country`
    FOREIGN KEY (`country_id`)
    REFERENCES `country` (`id`)
    ON DELETE SET NULL
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `user` (
  `id`             INT           NOT NULL AUTO_INCREMENT,
  `user_name`      TEXT          NOT NULL,
  `password`       TEXT          NOT NULL,
  `created_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uq_user_user_name` (`user_name`(191))
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `user_archive` (
  `id`             INT           NOT NULL AUTO_INCREMENT,
  `user_name`      TEXT          NOT NULL,
  `archived_at`    DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uq_user_archive_user_name` (`user_name`(191))
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `name` (
  `id`             INT           NOT NULL AUTO_INCREMENT,
  `first_name`     TEXT          NOT NULL,
  `middle_name`    TEXT,
  `last_name`      TEXT          NOT NULL,
  `suffix`         TEXT,
  `user_name`      TEXT          NULL,
  `created_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`user_name`(191)),
  CONSTRAINT `fk_name_user`
    FOREIGN KEY (`user_name`)
    REFERENCES `user` (`user_name`)
    ON DELETE CASCADE
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `email` (
  `id`             INT           NOT NULL AUTO_INCREMENT,
  `email`          TEXT          NOT NULL,
  `user_name`      TEXT          NULL,
  `created_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uq_email_email` (`email`(191)),
  INDEX (`user_name`(191)),
  CONSTRAINT `fk_email_user`
    FOREIGN KEY (`user_name`)
    REFERENCES `user` (`user_name`)
    ON DELETE SET NULL
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `phone_number` (
  `id`             INT           NOT NULL AUTO_INCREMENT,
  `phone_number`   TEXT          NOT NULL,
  `country_id`     INT           NULL,
  `user_name`      TEXT          NULL,
  `created_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uq_phone_number_number` (`phone_number`(191)),
  INDEX (`country_id`),
  INDEX (`user_name`(191)),
  CONSTRAINT `fk_phone_country`
    FOREIGN KEY (`country_id`)
    REFERENCES `country` (`id`)
    ON DELETE SET NULL,
  CONSTRAINT `fk_phone_user`
    FOREIGN KEY (`user_name`)
    REFERENCES `user` (`user_name`)
    ON DELETE CASCADE
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `property_type` (
  `id`             INT           NOT NULL AUTO_INCREMENT,
  `name`           TEXT          NOT NULL,
  `description`    TEXT,
  `created_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `property_owner_type` (
  `id`             INT           NOT NULL AUTO_INCREMENT,
  `type`           TEXT          NOT NULL,
  `remark`         TEXT,
  `created_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `property_owner` (
  `id`             INT           NOT NULL AUTO_INCREMENT,
  `first_name`     TEXT          NOT NULL,
  `middle_name`    TEXT,
  `last_name`      TEXT          NOT NULL,
  `suffix`         TEXT,
  `owner_type_id`  INT           NULL,
  `created_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`owner_type_id`),
  CONSTRAINT `fk_owner_owner_type`
    FOREIGN KEY (`owner_type_id`)
    REFERENCES `property_owner_type` (`id`)
    ON DELETE SET NULL
) ENGINE=InnoDB CHARSET=utf8mb4;


CREATE TABLE `brokerage` (
  `id`               INT           NOT NULL AUTO_INCREMENT,
  `company_name`     TEXT          NOT NULL,
  `description`      TEXT,
  `phone_number_id`  INT           NULL,
  `email_id`         INT           NULL,
  `location_id`      INT           NULL,
  `created_at`       DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`       DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uq_brokerage_company` (`company_name`(191)),
  INDEX (`phone_number_id`),
  INDEX (`email_id`),
  INDEX (`location_id`),
  CONSTRAINT `fk_brokerage_phone`
    FOREIGN KEY (`phone_number_id`) REFERENCES `phone_number` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_brokerage_email`
    FOREIGN KEY (`email_id`)        REFERENCES `email`        (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_brokerage_location`
    FOREIGN KEY (`location_id`)     REFERENCES `location`     (`id`) ON DELETE SET NULL
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `broker` (
  `id`               INT           NOT NULL AUTO_INCREMENT,
  `name_id`          INT           NULL,
  `description`      TEXT,
  `user_name`        TEXT          NULL,
  `brokerage_id`     INT           NULL,
  `phone_number_id`  INT           NULL,
  `email_id`         INT           NULL,
  `created_at`       DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`       DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`name_id`),
  INDEX (`user_name`(191)),
  INDEX (`brokerage_id`),
  INDEX (`phone_number_id`),
  INDEX (`email_id`),
  CONSTRAINT `fk_broker_name`       FOREIGN KEY (`name_id`)          REFERENCES `name`        (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_broker_user`       FOREIGN KEY (`user_name`)        REFERENCES `user`        (`user_name`) ON DELETE CASCADE,
  CONSTRAINT `fk_broker_brokerage`  FOREIGN KEY (`brokerage_id`)     REFERENCES `brokerage`   (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_broker_phone`      FOREIGN KEY (`phone_number_id`)   REFERENCES `phone_number` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_broker_email`      FOREIGN KEY (`email_id`)          REFERENCES `email`        (`id`) ON DELETE SET NULL
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `agent` (
  `id`               INT           NOT NULL AUTO_INCREMENT,
  `name_id`          INT           NULL,
  `description`      TEXT,
  `user_name`        TEXT          NULL,
  `brokerage_id`     INT           NULL,
  `phone_number_id`  INT           NULL,
  `email_id`         INT           NULL,
  `created_at`       DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`       DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`name_id`),
  INDEX (`user_name`(191)),
  INDEX (`brokerage_id`),
  INDEX (`phone_number_id`),
  INDEX (`email_id`),
  CONSTRAINT `fk_agent_name`        FOREIGN KEY (`name_id`)          REFERENCES `name`        (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_agent_user`        FOREIGN KEY (`user_name`)        REFERENCES `user`        (`user_name`) ON DELETE CASCADE,
  CONSTRAINT `fk_agent_brokerage`   FOREIGN KEY (`brokerage_id`)     REFERENCES `brokerage`   (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_agent_phone`       FOREIGN KEY (`phone_number_id`)   REFERENCES `phone_number` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_agent_email`       FOREIGN KEY (`email_id`)          REFERENCES `email`        (`id`) ON DELETE SET NULL
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `land_developer` (
  `id`               INT           NOT NULL AUTO_INCREMENT,
  `name`             TEXT          NOT NULL,
  `description`      TEXT,
  `user_name`        TEXT          NULL,
  `location_id`      INT           NULL,
  `phone_number_id`  INT           NULL,
  `email_id`         INT           NULL,
  `created_at`       DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`       DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uq_developer_name` (`name`(191)),
  INDEX (`user_name`(191)),
  INDEX (`location_id`),
  INDEX (`phone_number_id`),
  INDEX (`email_id`),
  CONSTRAINT `fk_dev_user`          FOREIGN KEY (`user_name`)        REFERENCES `user`        (`user_name`) ON DELETE CASCADE,
  CONSTRAINT `fk_dev_location`      FOREIGN KEY (`location_id`)      REFERENCES `location`    (`id`)        ON DELETE SET NULL,
  CONSTRAINT `fk_dev_phone`         FOREIGN KEY (`phone_number_id`)  REFERENCES `phone_number`(`id`)         ON DELETE SET NULL,
  CONSTRAINT `fk_dev_email`         FOREIGN KEY (`email_id`)         REFERENCES `email`       (`id`)         ON DELETE SET NULL
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `client` (
  `id`             INT           NOT NULL AUTO_INCREMENT,
  `name_id`        INT           NULL,
  `user_name`      TEXT          NULL,
  `phone_number_id`INT           NULL,
  `email_id`       INT           NULL,
  `created_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`     DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`name_id`),
  INDEX (`user_name`(191)),
  INDEX (`phone_number_id`),
  INDEX (`email_id`),
  CONSTRAINT `fk_client_name`      FOREIGN KEY (`name_id`)          REFERENCES `name`        (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_client_user`      FOREIGN KEY (`user_name`)        REFERENCES `user`        (`user_name`) ON DELETE CASCADE,
  CONSTRAINT `fk_client_phone`     FOREIGN KEY (`phone_number_id`)  REFERENCES `phone_number`(`id`)         ON DELETE SET NULL,
  CONSTRAINT `fk_client_email`     FOREIGN KEY (`email_id`)         REFERENCES `email`       (`id`)         ON DELETE SET NULL
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `property` (
  `id`                 INT           NOT NULL AUTO_INCREMENT,
  `name`               TEXT          NOT NULL,
  `description`        TEXT,
  `price`              DECIMAL(18,2) NOT NULL,
  `is_sold`            TINYINT(1)    NOT NULL DEFAULT 0,
  `is_for_sale`        TINYINT(1)    NOT NULL DEFAULT 1,
  `sale_price`         DECIMAL(18,2),
  `property_type_id`   INT           NULL,
  `dimension_area`     DECIMAL(18,2),
  `location_id`        INT           NULL,
  `land_developer_id`  INT           NULL,
  `property_owner_id`  INT           NULL,
  `created_at`         DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`         DATETIME      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`property_type_id`),
  INDEX (`location_id`),
  INDEX (`land_developer_id`),
  INDEX (`property_owner_id`),
  CONSTRAINT `fk_prop_type`        FOREIGN KEY (`property_type_id`) REFERENCES `property_type`  (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_prop_location`    FOREIGN KEY (`location_id`)      REFERENCES `location`       (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_prop_developer`   FOREIGN KEY (`land_developer_id`) REFERENCES `land_developer`  (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_prop_owner`       FOREIGN KEY (`property_owner_id`) REFERENCES `property_owner`  (`id`) ON DELETE SET NULL
) ENGINE=InnoDB CHARSET=utf8mb4;


CREATE TABLE `brokerage_property` (
  `brokerage_id`  INT NOT NULL,
  `property_id`   INT NOT NULL,
  PRIMARY KEY (`brokerage_id`,`property_id`),
  INDEX (`property_id`),
  CONSTRAINT `fk_bprop_brokerage`
    FOREIGN KEY (`brokerage_id`)
    REFERENCES `brokerage` (`id`)
    ON DELETE CASCADE,
  CONSTRAINT `fk_bprop_property`
    FOREIGN KEY (`property_id`)
    REFERENCES `property` (`id`)
    ON DELETE CASCADE
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `broker_property` (
  `broker_id`     INT NOT NULL,
  `property_id`   INT NOT NULL,
  PRIMARY KEY (`broker_id`,`property_id`),
  INDEX (`property_id`),
  CONSTRAINT `fk_brprop_broker`
    FOREIGN KEY (`broker_id`)
    REFERENCES `broker` (`id`)
    ON DELETE CASCADE,
  CONSTRAINT `fk_brprop_property`
    FOREIGN KEY (`property_id`)
    REFERENCES `property` (`id`)
    ON DELETE CASCADE
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `agent_property` (
  `agent_id`      INT NOT NULL,
  `property_id`   INT NOT NULL,
  PRIMARY KEY (`agent_id`,`property_id`),
  INDEX (`property_id`),
  CONSTRAINT `fk_aprop_agent`
    FOREIGN KEY (`agent_id`)
    REFERENCES `agent` (`id`)
    ON DELETE CASCADE,
  CONSTRAINT `fk_aprop_property`
    FOREIGN KEY (`property_id`)
    REFERENCES `property` (`id`)
    ON DELETE CASCADE
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `client_agent` (
  `client_id`     INT NOT NULL,
  `agent_id`      INT NOT NULL,
  PRIMARY KEY (`client_id`,`agent_id`),
  INDEX (`agent_id`),
  CONSTRAINT `fk_cagent_client`
    FOREIGN KEY (`client_id`)
    REFERENCES `client` (`id`)
    ON DELETE CASCADE,
  CONSTRAINT `fk_cagent_agent`
    FOREIGN KEY (`agent_id`)
    REFERENCES `agent` (`id`)
    ON DELETE CASCADE
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `client_property` (
  `client_id`     INT NOT NULL,
  `property_id`   INT NOT NULL,
  PRIMARY KEY (`client_id`,`property_id`),
  INDEX (`property_id`),
  CONSTRAINT `fk_cprop_client`
    FOREIGN KEY (`client_id`)
    REFERENCES `client` (`id`)
    ON DELETE CASCADE,
  CONSTRAINT `fk_cprop_property`
    FOREIGN KEY (`property_id`)
    REFERENCES `property` (`id`)
    ON DELETE CASCADE
) ENGINE=InnoDB CHARSET=utf8mb4;


CREATE TABLE `brokerage_image` (
  `id`               INT      NOT NULL AUTO_INCREMENT,
  `brokerage_id`     INT      NOT NULL,
  `file_path`        TEXT     NOT NULL,
  `extension_type`   TEXT,
  `created_at`       DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`brokerage_id`),
  CONSTRAINT `fk_bimage_brokerage`
    FOREIGN KEY (`brokerage_id`)
    REFERENCES `brokerage` (`id`)
    ON DELETE CASCADE
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `broker_image` (
  `id`               INT      NOT NULL AUTO_INCREMENT,
  `broker_id`        INT      NOT NULL,
  `file_path`        TEXT     NOT NULL,
  `extension_type`   TEXT,
  `created_at`       DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`broker_id`),
  CONSTRAINT `fk_brimage_broker`
    FOREIGN KEY (`broker_id`)
    REFERENCES `broker` (`id`)
    ON DELETE CASCADE
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `agent_image` (
  `id`               INT      NOT NULL AUTO_INCREMENT,
  `agent_id`         INT      NOT NULL,
  `file_path`        TEXT     NOT NULL,
  `extension_type`   TEXT,
  `created_at`       DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`agent_id`),
  CONSTRAINT `fk_aimage_agent`
    FOREIGN KEY (`agent_id`)
    REFERENCES `agent` (`id`)
    ON DELETE CASCADE
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `land_developer_image` (
  `id`               INT      NOT NULL AUTO_INCREMENT,
  `land_developer_id`INT      NOT NULL,
  `file_path`        TEXT     NOT NULL,
  `extension_type`   TEXT,
  `created_at`       DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`land_developer_id`),
  CONSTRAINT `fk_dimage_developer`
    FOREIGN KEY (`land_developer_id`)
    REFERENCES `land_developer` (`id`)
    ON DELETE CASCADE
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE `property_image` (
  `id`               INT      NOT NULL AUTO_INCREMENT,
  `property_id`      INT      NOT NULL,
  `file_path`        TEXT     NOT NULL,
  `extension_type`   TEXT,
  `created_at`       DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`property_id`),
  CONSTRAINT `fk_pimage_property`
    FOREIGN KEY (`property_id`)
    REFERENCES `property` (`id`)
    ON DELETE CASCADE
) ENGINE=InnoDB CHARSET=utf8mb4;
